name: Pylint

on: [push, pull_request]

jobs:
  pylint:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python 3.12
      uses: actions/setup-python@v6
      with:
        python-version: '3.12'

    - name: Install Poetry
      run: |
        pip install poetry

    - name: Install dependencies
      run: |
        poetry install

    - name: Install pylint
      run: |
        pip install pylint==3.3.1

    - name: Run pylint on source files
      run: |
        # Find all Python source files and run pylint on them
        find src/ -name "*.py" -not -path "./.venv/*" -not -path "./venv/*" -not -path "./.git/*" > pylint-files.txt
        if [ -s pylint-files.txt ]; then
          pylint --rcfile=.pylintrc $(cat pylint-files.txt)
        else
          echo "No source Python files found to analyze"
          exit 0
        fi

    - name: Run pylint on test files
      run: |
        # Find all Python test files and run pylint on them
        find tests/ -name "*.py" -not -path "./.venv/*" -not -path "./venv/*" -not -path "./.git/*" > pylint-test-files.txt
        if [ -s pylint-test-files.txt ]; then
          echo "Running pylint on test files..."
          pylint --disable=C0103,C0114,C0115,C0116,W0613 --rcfile=.pylintrc $(cat pylint-test-files.txt)
        else
          echo "No test Python files found to analyze"
        fi
